---
isbn: 9787111611929
category: null
lastReadDate: 2021-11-15T00:00:00.000Z
doc_type: weread-highlights-reviews
bookId: '3000954940'
author: 华为云容器服务团队，杜军，等
cover: >-
  http://img13.360buyimg.com/n12/s428x616_jfs/t27340/100/1429686515/125856/8175645/5be3d9acNfedebe3e.jpg
reviewCount: 3
noteCount: 1
---
# 元数据
> [!abstract] 云原生分布式存储基石：etcd深入解析
> - ![ 云原生分布式存储基石：etcd深入解析|200](http://img13.360buyimg.com/n12/s428x616_jfs/t27340/100/1429686515/125856/8175645/5be3d9acNfedebe3e.jpg)
> - 书名： 云原生分布式存储基石：etcd深入解析
> - 作者： 华为云容器服务团队，杜军，等
> - 简介： 本书为读者深度解析分布式键值存储系统，全书分为3部分，第1部分是对分布式系统的概念和一致性协议的综述，重点解析Raft协议，使读者对分布式键值存储系统有初步了解；第2部分介绍etcd安装、部署、运维、安全等方面的知识，帮助读者进一步掌握分布式系统的使用方法，熟悉其常见功能和使用场景；第3部分是本书的特色部分，从代码层次深入探讨了etcd各大关键特性的具体设计与实现原理，读者读完本部分，会对整个etcd的架构有更加清晰的认识，可以从中汲取灵感，从而将一些实用的经验应用到自己的分布式系统中。
> - 出版时间 2018-11-01
> - ISBN： 9787111611929
> - 分类： 
> - 出版社： 机械工业出版社

# 高亮划线

## 1.4 Raft协议：为可理解性而生


- 📌 Leader广播心跳的周期必须要短于选举定时器的超时时间 ^3000954940-9-6520-6548
    - ⏱ 2021-11-13 14:36:45 

- 📌 或者已经把选票投给当前候选人了，并且候选人的日志和自己的日志一样新，则返回（term，true），表示在这个任期，选票都投给这位候选人。如果之前已经把选票投给其他人了，那么很遗憾，这张选票还是不能投给他，这时就会返回（term，false）。
3.日志复制
一旦某个领导人赢得了选举，那么它就会开始接收客户端的请求。 ^3000954940-9-9287
    - ⏱ 2021-11-13 14:45:34 

- 📌 这种场景通常发生在Follower刚从故障中恢复过来的场景。
4.安全性Q&A
Raft算法是强领导人模型，一旦Follower与Leader发生了冲突，就将无条件服从Leader。因此，Leader选举是Raft算法中非常重要的一环，如果选举出来的Leader其自身的日志就是不正确的，那么将会直接影响到Raft算法正确稳定的运行。 ^3000954940-9-16552
    - ⏱ 2021-11-13 23:33:02 

- 📌 2.领导人选举
Raft通过选举一个权力至高无上的领导人，并采取赋予他管理复制日志重任的方式来维护节点间复制日志的一致性。领导人从客户端接收日志条目，再把日志条目复制到其他服务器上，并且在保证安全性的前提下，告诉其他服务器将日志条目应用到它们的状态机中。强领导人的存在大大简化了复制日志的管理。例如，领导人可以决定新的日志条目需要放在日志文件的什么位置，而不需要和其他服务器商议，并且数据都是单向地从领导人流向其他服务器。 ^3000954940-9-5250
    - ⏱ 2021-11-13 23:33:55 
# 读书笔记

## 1.4 Raft协议：为可理解性而生

### 划线评论
- 📌 每一个客户端请求都将被解析成一条需要复制状态机执行的指令。领导人将把这条指令作为一条新的日志条目加入它的日志文件中，然后并行地向其他Raft节点发起AppendEntries RPC，要求其他节点复制这个日志条目。当这个日志条目被“安全”地复制之后（下文会详细论述符合什么样的条件才算安全），Leader会将这条日志应用（apply，即执行该指令）到它的状态机中，并且向客户端返回执行结果。  ^13176609-7uMxcMUxh
    - 💭 也不是它接受了请求，如果follower接到会转发给master处理
    - ⏱ 2021-11-13 14:46:50

### 划线评论
- 📌 为了避免发生这种问题，Raft采用了一种非常简单的方法——随机重试。例如，设置一个区间（150～300ms），超时时间将从这个区间内随机选择。错开发起竞选的时间窗口，可以使得在大多数情况下只有一个节点会率先超时，该节点会在其他节点超时之前赢得选举，并且向其他节点发送心跳信息。要知道，在每次选票打平时都会采用这种随机的方式，因此连续发生选票被均分的概率非常小。  ^13176609-7uMwY67uz
    - 💭 有的人就生在罗马，成为领导也有一定的随机幸运
    - ⏱ 2021-11-13 14:43:12

### 划线评论
- 📌 当这种情形发生时，显然不能一直这样“僵持下去”，于是Raft的每一个候选人又都设置了超时时间（类似于选举超时时间，区别是选举超时时间是针对Follower的），发生超时后，每个候选人自增任期号（Term++）并且发起新一轮的拉选票活动。然而，如果没有其他手段来分配选票的话，选票均分的情况可能会无限循环下去（理论上存在这种可能性，还记得FLP不可能性定理吗）。  ^13176609-7uMwMPjN3
    - 💭 补充现在还有preVote机制防止这种投票失败再次选举term++问题提供选举成功率
    - ⏱ 2021-11-13 14:40:26
   
# 本书评论
