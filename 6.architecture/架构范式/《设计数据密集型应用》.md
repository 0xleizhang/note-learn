第一章 单机

\-\-\-

\# 1 可靠性，扩展性，可维护性

\# 2 数据模型与查询语言

关系型\- >文档型 -关系多了\> 图

文档型：一对多，

![image.png](1619576543166-aa7d4c65-74d2-4335-b2c0-2cf7f8463578.png)

\# 3 数据存储与检索
![image.png](1619576549445-b217fca8-0a6a-4729-84a6-32043453f893.png)

\# 4 数据编码与演化

向后兼容，新程序能够处理老程序产生的数据

向前兼容，老程序能够处理新程序产生的数据

xml json cvs

基于模式：Facebook thrift，protocol buffers ,apache avro

演化性重要在于：可以独立的更改和部署RPC客户端和服务端

数据流模型

数据库

RPC和REST API
\> REST不是一种协议，而是一个基于HTTP原则的设计理念［34,35］。它强调简单的数据格式，使用URL来标识资惊，并使用HTTP功能进行缓存控制、身份验证和内容类型协商。与SOAP相比，REST已经越来越受欢迎，至少在跨组织服务集成的背景下口6J,井经常与微服务相关联［31］。根据REST原则所设计的API称为RESTful

异步消息，MQ或Actor

![image.png](1619576555733-05e6a8d2-baec-49e3-87dd-4083e9224070.png)

第二章多机

\-\-\-

\# 5 数据复制
![image.png](1620359818014-115f6fd5-d372-4bea-b985-a3c6a7406f94.png)

\## 主从复制 复制滞后问题

用户发起写请求，然后在滞后的副本上读数据。此时需要read-after-write一致性（写后一致性=读写一致）

用户看到了最新内窑之后又读到了过期的内窑，好像时间被固拨，此时需要单调读一致性

 单调读一致性，读已复制从节点A，第二次读未复制完成节点B，导致不一致

前缀读一致性：对于一系列按照某个顺序发生的写请求，那么读取这些内容时也会按照当时写入的顺序。

\## 多主节点复制
适用场景，多数据中心

离线客户端、协作编辑

多主复制最大问题：写冲突

副本会出现错误的写请求到达顺序。客户端insert 一记录A节点，更新这条记录B节点，B节点日志先到C节点，A节点插入日志后到。解决方案：版本向量

\### 处理写冲突
0 如果同步检测处理冲突 不如直接用 主从复制了。

1 避免冲突，特定记录写请求控制都走一个主节点

2 制定复写/合并规则

3 交由应用层处理

自动冲突解决算法：

无冲突的复制数据类型（Conflictfree Replicated Datatypes, CRDT）

可合并的持久数据结构（Mergeablepersistent data)

操作转换（0 pera ti on a I transfo rma tion[421）。它是Etherpad[301和GoogleDocs[311等协作编辑应用背后的冲突解决算法

\### 拓扑结构

环形，星形（中间节点），全链

\## 无主节点复制
客户端直接将其写请求发送到多副本，而在其他一些实现中，由一个协调者节点代表客户端进行写人，但与主节点的数据库不同，协调者井不负责写入顺序的维护。

Quorum 一致性

w + r > n 写少读多w设大

写 并发w节点 都成功=写成功

读 并发读r节点 都成功=读成功

\# 6 数据分区
![6数据分区.jpg](1621235295341-89af28fb-bc0a-42aa-8541-f0197cb21e66.jpeg)

关键字分区 容易出现热点

hash 分区 无法范围查询，也会出现热点

\# 7 事务
![7事务.jpg](1621235310861-e68056ac-a05f-4cfb-94d7-ab29accf4168.jpeg)

\## 串行化

实现方式：单线程严格的串行化

两阶段锁定 two-phase locking, 2PL

乐观并发控制 可串行化的快照隔离（SSI)

 提交时冲突检测，中止违背串形化的操作

\# 8 分布式系统的挑战
不可靠的网络

不可靠的时钟

进程暂停

\# 9 一致性与共识
![image.png](1621327268317-1642fa59-fdbf-416f-8694-343119b202a5.png)

第三部分

\# 10 批处理系统
![image.png](1623042772674-20f079ee-9d46-4198-966b-5ea3cc5b2e2f.png)

mapreduce 输入-输出>目录->next 输入 存在中间临时写入

spark，flink,tez 执行引擎

map reduce新一代：改进编程模型，提高处理效率，扩大解决的问题域

有界数据

\# 11 流处理系统
![image.png](1623049492438-1bc29d5c-b275-46df-83b0-b7f0835e95b3.png)

数据库->变更捕获系统->流

变更数据捕获（Change Data Capture, CDC

alibaba/canal 一个mysql变更捕获软件

数据分为记录数据和衍生数据，衍生数据包括索引，缓存

mysql记录的变化需要redis缓存和elsticsearch索引也要更新

\## 流处理
复杂事件处理（ComplexEvent Processing, CEP）=从流上搜索特定模式的事件
\> CEP系统通常使用像SQL这样的高级声明式查询语言或图形用户界面，来描述应该检测到的事件模式。这些查询提交给一个处理引擎，主引擎使用输入流并\*\*在内部维护匹配所需的状态机\*\*。当发现匹配时，引擎产生一个复杂的事件，这个事件包括检测到的事件模式的细节信息

\# 12 数据系统的未来
![image.png](1623119137993-32d88114-bafa-432b-a9be-5f5a5e685fd6.png)